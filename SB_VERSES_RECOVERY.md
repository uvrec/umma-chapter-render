# üîß –í—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –≤—ñ—Ä—à—ñ–≤ ≈örƒ´mad-BhƒÅgavatam

## –ü—Ä–æ–±–ª–µ–º–∞

–ü—ñ—Å–ª—è –ø–æ–º–∏–ª–∫–æ–≤–æ–≥–æ —ñ–º–ø–æ—Ä—Ç—É –¥–µ—è–∫—ñ –≤—ñ—Ä—à—ñ ≈örƒ´mad-BhƒÅgavatam –±—É–ª–∏ –ø–æ–∑–Ω–∞—á–µ–Ω—ñ —è–∫:
- **–í–∏–¥–∞–ª–µ–Ω—ñ** (`deleted_at` NOT NULL) - –º'—è–∫–µ –≤–∏–¥–∞–ª–µ–Ω–Ω—è
- **–ù–µ–æ–ø—É–±–ª—ñ–∫–æ–≤–∞–Ω—ñ** (`is_published = false`)
- **–ü–æ—Ä–æ–∂–Ω—ñ** (`translation_uk` —Ç–∞ `translation_en` –ø–æ—Ä–æ–∂–Ω—ñ)

–í—ñ—Ä—à—ñ **—ñ—Å–Ω—É—é—Ç—å –≤ –±–∞–∑—ñ –¥–∞–Ω–∏—Ö**, –∞–ª–µ –Ω–µ –ø–æ–∫–∞–∑—É—é—Ç—å—Å—è –Ω–∞ —Å–∞–π—Ç—ñ —á–µ—Ä–µ–∑ —Ñ—ñ–ª—å—Ç—Ä–∏ –≤ –∫–æ–¥—ñ:
- `src/pages/ChapterVersesList.tsx:126-127`
- `src/pages/BookOverview.tsx:89-90`

## –†—ñ—à–µ–Ω–Ω—è

–Ñ 3 —Å–ø–æ—Å–æ–±–∏ –≤–∏–ø—Ä–∞–≤–∏—Ç–∏ –ø—Ä–æ–±–ª–µ–º—É:

### 1Ô∏è‚É£ Python —Å–∫—Ä–∏–ø—Ç (–†–ï–ö–û–ú–ï–ù–î–û–í–ê–ù–û)

**–ü–µ—Ä–µ–≤–∞–≥–∏**: –ë–µ–∑–ø–µ—á–Ω–æ, —î dry-run, –º–æ–∂–Ω–∞ –æ–±—Ä–∞—Ç–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É –ø—ñ—Å–Ω—é/–≥–ª–∞–≤—É

```bash
# –ö—Ä–æ–∫ 1: –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ SERVICE_ROLE key
export SUPABASE_SERVICE_KEY='eyJ...'  # –û—Ç—Ä–∏–º–∞–π—Ç–µ –≤ Supabase Dashboard

# –ö—Ä–æ–∫ 2: Dry-run (–ø–æ–¥–∏–≤–∏—Ç–∏—Å—è —â–æ –±—É–¥–µ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–æ –ë–ï–ó –∑–º—ñ–Ω)
python3 repair_sb_verses.py --dry-run

# –ö—Ä–æ–∫ 3: –í–∏–ø—Ä–∞–≤–∏—Ç–∏ –í–°–Ü –≤—ñ—Ä—à—ñ
python3 repair_sb_verses.py

# –ê–ë–û –≤–∏–ø—Ä–∞–≤–∏—Ç–∏ —Ç—ñ–ª—å–∫–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É –ø—ñ—Å–Ω—é:
python3 repair_sb_verses.py --canto 2

# –ê–ë–û –≤–∏–ø—Ä–∞–≤–∏—Ç–∏ —Ç—ñ–ª—å–∫–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É –≥–ª–∞–≤—É:
python3 repair_sb_verses.py --canto 2 --chapter 10
```

### 2Ô∏è‚É£ SQL —Å–∫—Ä–∏–ø—Ç (Supabase SQL Editor)

**–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ —è–∫—â–æ —É –≤–∞—Å —î –¥–æ—Å—Ç—É–ø –¥–æ Supabase Dashboard**

```bash
# –ö—Ä–æ–∫ 1: –î—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ (–ø–æ–∫–∞–∑—É—î —Å—Ç–∞–Ω –≤—ñ—Ä—à—ñ–≤)
# –í—ñ–¥–∫—Ä–∏–π—Ç–µ Supabase Dashboard ‚Üí SQL Editor
# –í—Å—Ç–∞–≤—Ç–µ –≤–º—ñ—Å—Ç —Ñ–∞–π–ª—É: diagnose_sb_verses.sql
# –í–∏–∫–æ–Ω–∞–π—Ç–µ

# –ö—Ä–æ–∫ 2: –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è
# –í—Å—Ç–∞–≤—Ç–µ –≤–º—ñ—Å—Ç —Ñ–∞–π–ª—É: repair_sb_verses.sql
# –†–æ–∑–∫–æ–º–µ–Ω—Ç—É–π—Ç–µ –±–ª–æ–∫ UPDATE (–≤–∏–¥–∞–ª—ñ—Ç—å -- –Ω–∞ –ø–æ—á–∞—Ç–∫—É —Ä—è–¥–∫—ñ–≤)
# –í–∏–∫–æ–Ω–∞–π—Ç–µ
```

### 3Ô∏è‚É£ Python –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ (–¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏)

```bash
# –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Å—Ç–∞–Ω –ë–î —á–µ—Ä–µ–∑ Python
python3 check_db_state.py
```

## –î–µ –≤–∑—è—Ç–∏ SUPABASE_SERVICE_KEY?

1. –ü–µ—Ä–µ–π–¥—ñ—Ç—å —É Supabase Dashboard:
   ```
   https://supabase.com/dashboard/project/qeplxgqadcbwlrbgydlb/settings/api
   ```

2. –°–∫–æ–ø—ñ—é–π—Ç–µ **`service_role`** key (–ù–ï `anon` key!)
   - –¶–µ –¥–æ–≤–≥–∏–π —Ç–æ–∫–µ–Ω —â–æ –ø–æ—á–∏–Ω–∞—î—Ç—å—Å—è –∑ `eyJ...`

3. –í—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å —è–∫ –∑–º—ñ–Ω–Ω—É –æ—Ç–æ—á–µ–Ω–Ω—è:
   ```bash
   export SUPABASE_SERVICE_KEY='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...'
   ```

4. –ê–ë–û –¥–æ–¥–∞–π—Ç–µ –≤ `.env` —Ñ–∞–π–ª:
   ```bash
   echo 'SUPABASE_SERVICE_KEY="eyJ..."' >> .env
   ```

## –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î?

### –î—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø–æ–∫–∞–∑—É—î:
- –ó–∞–≥–∞–ª—å–Ω—É –∫—ñ–ª—å–∫—ñ—Å—Ç—å –≤—ñ—Ä—à—ñ–≤
- –°–∫—ñ–ª—å–∫–∏ –≤–∏–¥–∞–ª–µ–Ω–æ (`deleted_at` NOT NULL)
- –°–∫—ñ–ª—å–∫–∏ –Ω–µ–æ–ø—É–±–ª—ñ–∫–æ–≤–∞–Ω–æ (`is_published = false`)
- –°–∫—ñ–ª—å–∫–∏ –∑ –ø–æ—Ä–æ–∂–Ω—ñ–º–∏ –ø–µ—Ä–µ–∫–ª–∞–¥–∞–º–∏
- –î–µ—Ç–∞–ª—å–Ω—É —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –∫–æ–∂–Ω—ñ–π –ø—ñ—Å–Ω—ñ —Ç–∞ –≥–ª–∞–≤—ñ

### –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è —Ä–æ–±–∏—Ç—å:
1. –í—Å—Ç–∞–Ω–æ–≤–ª—é—î `deleted_at = NULL` (–≤—ñ–¥–Ω–æ–≤–ª—é—î –≤–∏–¥–∞–ª–µ–Ω—ñ –≤—ñ—Ä—à—ñ)
2. –í—Å—Ç–∞–Ω–æ–≤–ª—é—î `is_published = true` (–ø—É–±–ª—ñ–∫—É—î –Ω–µ–æ–ø—É–±–ª—ñ–∫–æ–≤–∞–Ω—ñ)
3. –ü–æ–∫–∞–∑—É—î —Å–∫—ñ–ª—å–∫–∏ –≤—ñ—Ä—à—ñ–≤ –±—É–ª–æ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–æ

## –ü—ñ—Å–ª—è –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è

1. –í—ñ–¥–∫—Ä–∏–π—Ç–µ —Å–∞–π—Ç: https://vedavoice.org/veda-reader/srimad-bhagavatam
2. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —â–æ –ø—ñ—Å–Ω—ñ —Ç–∞ –≥–ª–∞–≤–∏ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—é—Ç—å—Å—è
3. –í—ñ–¥–∫—Ä–∏–π—Ç–µ –±—É–¥—å-—è–∫—É –≥–ª–∞–≤—É —ñ –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ —â–æ –≤—ñ—Ä—à—ñ —î

## –§–∞–π–ª–∏ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó

- `diagnose_sb_verses.sql` - SQL –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Å—Ç–∞–Ω—É –≤—ñ—Ä—à—ñ–≤
- `repair_sb_verses.sql` - SQL –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –≤—ñ—Ä—à—ñ–≤
- `repair_sb_verses.py` - Python —Å–∫—Ä–∏–ø—Ç –¥–ª—è –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è (—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ)
- `check_db_state.py` - Python –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∑–∞–≥–∞–ª—å–Ω–æ–≥–æ —Å—Ç–∞–Ω—É –ë–î

## –©–æ —Å—Ç–∞–ª–æ—Å—è? (—ñ—Å—Ç–æ—Ä—ñ—è –ø—Ä–æ–±–ª–µ–º–∏)

1. –Ø —Å—Ç–≤–æ—Ä–∏–≤ TypeScript –ø–∞—Ä—Å–µ—Ä EPUB –¥–ª—è –≤–µ–±-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É
2. –ü–∞—Ä—Å–µ—Ä –±—É–≤ –Ω–µ–ø–æ–≤–Ω–∏–π —ñ –ø–æ–≤–µ—Ä—Ç–∞–≤ –ø–æ—Ä–æ–∂–Ω—ñ/–Ω–µ–∫–æ—Ä–µ–∫—Ç–Ω—ñ –¥–∞–Ω—ñ
3. –¶—ñ –¥–∞–Ω—ñ –±—É–ª–∏ –∑–±–µ—Ä–µ–∂–µ–Ω—ñ —á–µ—Ä–µ–∑ `importSingleChapter()` –∑ `strategy: "upsert"`
4. Upsert **–ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞–≤** —ñ—Å–Ω—É—é—á—ñ –≤—ñ—Ä—à—ñ –ø–æ—Ä–æ–∂–Ω—ñ–º–∏ –¥–∞–Ω–∏–º–∏
5. –í —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ –≤—ñ—Ä—à—ñ —Å—Ç–∞–ª–∏:
   - `deleted_at` NOT NULL (–≤–∏–¥–∞–ª–µ–Ω—ñ)
   - `is_published = false` (–Ω–µ–æ–ø—É–±–ª—ñ–∫–æ–≤–∞–Ω—ñ)
   - –ü–æ—Ä–æ–∂–Ω—ñ `translation_uk/translation_en`

6. –ö–æ–¥ –±—É–ª–æ –≤–∏–¥–∞–ª–µ–Ω–æ –≤ commit `445fb05`, –∞–ª–µ –ë–î –Ω–µ –≤—ñ–¥–Ω–æ–≤–∏–ª–∞—Å—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ

## –ó–∞–ø–æ–±—ñ–≥–∞–Ω–Ω—è –≤ –º–∞–π–±—É—Ç–Ω—å–æ–º—É

‚úÖ –ù–µ–±–µ–∑–ø–µ—á–Ω–∏–π TypeScript –∫–æ–¥ –≤–∏–¥–∞–ª–µ–Ω–æ
‚úÖ Python –ø–∞—Ä—Å–µ—Ä –º–∞—î —Ñ—É–Ω–∫—Ü—ñ—é `save_to_supabase()` —è–∫–∞ –ù–ï –†–ï–ê–õ–Ü–ó–û–í–ê–ù–ê
‚úÖ –ü–µ—Ä–µ–¥ —ñ–º–ø–æ—Ä—Ç–æ–º –∑–∞–≤–∂–¥–∏ —Ä–æ–±–∏—Ç–∏ dry-run
‚úÖ –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ `INSERT` –∑–∞–º—ñ—Å—Ç—å `UPSERT` –¥–ª—è –Ω–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö
‚úÖ –ú–∞—Ç–∏ backup —Å—Ç—Ä–∞—Ç–µ–≥—ñ—é –≤ Supabase

---

**–ê–≤—Ç–æ—Ä –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è**: Claude Code
**–î–∞—Ç–∞**: 2025-11-17
**–í–µ—Ä—Å—ñ—è**: 1.0
