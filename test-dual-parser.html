<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Dual Source Parser</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #d35400;
            border-bottom: 3px solid #e67e22;
            padding-bottom: 10px;
        }
        h2 {
            color: #2c3e50;
            margin-top: 30px;
            border-left: 4px solid #3498db;
            padding-left: 15px;
        }
        .test-controls {
            margin: 20px 0;
            padding: 20px;
            background: #ecf0f1;
            border-radius: 5px;
        }
        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
            margin-right: 10px;
        }
        button:hover {
            background: #2980b9;
        }
        .loading {
            color: #e67e22;
            font-weight: bold;
        }
        .success {
            color: #27ae60;
            font-weight: bold;
        }
        .error {
            color: #e74c3c;
            font-weight: bold;
        }
        .result-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #bdc3c7;
            border-radius: 5px;
            background: #fafafa;
        }
        .result-section h3 {
            margin-top: 0;
            color: #34495e;
        }
        .field {
            margin: 10px 0;
            padding: 10px;
            background: white;
            border-left: 3px solid #3498db;
        }
        .field-label {
            font-weight: bold;
            color: #7f8c8d;
            font-size: 12px;
            text-transform: uppercase;
            margin-bottom: 5px;
        }
        .field-value {
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .diacritics-check {
            background: #d5f4e6;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .diacritics-check.fail {
            background: #fadbd8;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üî¨ –¢–µ—Å—Ç Dual Source Parser (Vedabase EN + Gitabase UA)</h1>
        
        <div class="test-controls">
            <h3>–í—ñ—Ä—à –¥–ª—è —Ç–µ—Å—Ç—É: CC Antya-lila 7.3</h3>
            <button onclick="testParser()">‚ñ∂Ô∏è –ó–∞–ø—É—Å—Ç–∏—Ç–∏ —Ç–µ—Å—Ç</button>
            <button onclick="clearResults()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏</button>
            <div id="status" style="margin-top: 15px;"></div>
        </div>

        <div id="results"></div>
    </div>

    <script type="module">
        import { 
            parseVedabaseCC, 
            parseGitabaseCC, 
            mergeVedabaseAndGitabase,
            generateVedabaseURL,
            generateGitabaseURL
        } from './src/utils/dualSourceParser.ts';

        window.testParser = async function() {
            const statusEl = document.getElementById('status');
            const resultsEl = document.getElementById('results');
            
            statusEl.innerHTML = '<span class="loading">‚è≥ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö –∑ Vedabase —Ç–∞ Gitabase...</span>';
            resultsEl.innerHTML = '';

            try {
                // –ü–∞—Ä–∞–º–µ—Ç—Ä–∏ –≤—ñ—Ä—à–∞
                const lila = 'antya';
                const lilaNum = 3;
                const chapter = 7;
                const verse = 3;

                // –ì–µ–Ω–µ—Ä—É—î–º–æ URLs
                const vedabaseUrl = generateVedabaseURL(lila, chapter, verse);
                const gitabaseUrl = generateGitabaseURL(lilaNum, chapter, verse);

                console.log('Vedabase URL:', vedabaseUrl);
                console.log('Gitabase URL:', gitabaseUrl);

                // Fetch –æ–±–∏–¥–≤—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏
                statusEl.innerHTML = '<span class="loading">‚è≥ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è Vedabase EN...</span>';
                const vedabaseResponse = await fetch(vedabaseUrl);
                const vedabaseHtml = await vedabaseResponse.text();

                statusEl.innerHTML = '<span class="loading">‚è≥ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è Gitabase UA...</span>';
                const gitabaseResponse = await fetch(gitabaseUrl);
                const gitabaseHtml = await gitabaseResponse.text();

                // –ü–∞—Ä—Å–∏–Ω–≥
                statusEl.innerHTML = '<span class="loading">‚è≥ –ü–∞—Ä—Å–∏–Ω–≥ Vedabase EN...</span>';
                const vedabaseData = parseVedabaseCC(vedabaseHtml, vedabaseUrl);
                
                statusEl.innerHTML = '<span class="loading">‚è≥ –ü–∞—Ä—Å–∏–Ω–≥ Gitabase UA...</span>';
                const gitabaseData = parseGitabaseCC(gitabaseHtml, gitabaseUrl);

                // –û–±'—î–¥–Ω–∞–Ω–Ω—è
                statusEl.innerHTML = '<span class="loading">‚è≥ –û–±\'—î–¥–Ω–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö...</span>';
                const merged = mergeVedabaseAndGitabase(
                    vedabaseData,
                    gitabaseData,
                    lila,
                    chapter,
                    verse,
                    vedabaseUrl,
                    gitabaseUrl
                );

                if (!merged) {
                    throw new Error('–ù–µ –≤–¥–∞–ª–æ—Å—è –æ–±\'—î–¥–Ω–∞—Ç–∏ –¥–∞–Ω—ñ');
                }

                statusEl.innerHTML = '<span class="success">‚úÖ –¢–µ—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–æ —É—Å–ø—ñ—à–Ω–æ!</span>';

                // –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤
                displayResults(merged, vedabaseData, gitabaseData);

            } catch (error) {
                console.error('–ü–æ–º–∏–ª–∫–∞ —Ç–µ—Å—Ç—É:', error);
                statusEl.innerHTML = `<span class="error">‚ùå –ü–æ–º–∏–ª–∫–∞: ${error.message}</span>`;
            }
        };

        function displayResults(merged, vedabase, gitabase) {
            const resultsEl = document.getElementById('results');
            
            let html = '<h2>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –ø–∞—Ä—Å–∏–Ω–≥—É</h2>';

            // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –¥—ñ–∞–∫—Ä–∏—Ç–∏–∫–∏ –≤ transliteration_ua
            const hasDiacritics = /[–∞ÃÑ—ñÃÑ”Ø–ΩÃ£—ÇÃ£–¥Ã£—àÃÅ–ΩÃÉ–ΩÃá–ºÃá—ÖÃ£]/.test(merged.transliteration_ua);
            html += `
                <div class="diacritics-check ${hasDiacritics ? '' : 'fail'}">
                    ${hasDiacritics ? '‚úÖ' : '‚ùå'} –î—ñ–∞–∫—Ä–∏—Ç–∏–∫–∞ –≤ transliteration_ua: ${hasDiacritics ? '–ü–†–ò–°–£–¢–ù–Ø' : '–í–Ü–î–°–£–¢–ù–Ø'}
                </div>
            `;

            // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –¥—ñ–∞–∫—Ä–∏—Ç–∏–∫–∏ –≤ synonyms_ua
            const hasDiacriticsSyn = /[–∞ÃÑ—ñÃÑ”Ø–ΩÃ£—ÇÃ£–¥Ã£—àÃÅ–ΩÃÉ–ΩÃá–ºÃá—ÖÃ£]/.test(merged.synonyms_ua);
            html += `
                <div class="diacritics-check ${hasDiacriticsSyn ? '' : 'fail'}">
                    ${hasDiacriticsSyn ? '‚úÖ' : '‚ùå'} –î—ñ–∞–∫—Ä–∏—Ç–∏–∫–∞ –≤ synonyms_ua: ${hasDiacriticsSyn ? '–ü–†–ò–°–£–¢–ù–Ø' : '–í–Ü–î–°–£–¢–ù–Ø'}
                </div>
            `;

            // Vedabase EN –¥–∞–Ω—ñ
            html += '<div class="result-section">';
            html += '<h3>üá¨üáß Vedabase EN (–≤–∏—Ö—ñ–¥–Ω—ñ –¥–∞–Ω—ñ)</h3>';
            html += renderField('Bengali/Sanskrit', vedabase.bengali);
            html += renderField('Transliteration EN (IAST)', vedabase.transliteration_en);
            html += renderField('Synonyms EN (–ø–µ—Ä—à—ñ 200 —Å–∏–º–≤–æ–ª—ñ–≤)', vedabase.synonyms_en.substring(0, 200) + '...');
            html += renderField('Translation EN (–ø–µ—Ä—à—ñ 150 —Å–∏–º–≤–æ–ª—ñ–≤)', vedabase.translation_en.substring(0, 150) + '...');
            html += '</div>';

            // Gitabase UA –¥–∞–Ω—ñ
            html += '<div class="result-section">';
            html += '<h3>üá∫üá¶ Gitabase UA (–≤–∏—Ö—ñ–¥–Ω—ñ –¥–∞–Ω—ñ)</h3>';
            html += renderField('Transliteration UA (–∑—ñ–ø—Å–æ–≤–∞–Ω–∞)', gitabase.transliteration_ua.substring(0, 150) + '...');
            html += renderField('Synonyms UA (–∑—ñ–ø—Å–æ–≤–∞–Ω—ñ, –ø–µ—Ä—à—ñ 200)', gitabase.synonyms_ua.substring(0, 200) + '...');
            html += renderField('Translation UA (–ø–µ—Ä—à—ñ 150)', gitabase.translation_ua.substring(0, 150) + '...');
            html += '</div>';

            // –û–±'—î–¥–Ω–∞–Ω—ñ –¥–∞–Ω—ñ
            html += '<div class="result-section">';
            html += '<h3>üéØ MERGED DATA (—Ñ—ñ–Ω–∞–ª—å–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç)</h3>';
            html += renderField('Bengali', merged.bengali);
            html += renderField('Transliteration EN (IAST)', merged.transliteration_en);
            html += renderField('Transliteration UA (–∫–æ–Ω–≤–µ—Ä—Ç–æ–≤–∞–Ω–æ –∑ IAST)', merged.transliteration_ua);
            html += renderField('Synonyms EN (IAST, –ø–µ—Ä—à—ñ 300)', merged.synonyms_en.substring(0, 300) + '...');
            html += renderField('Synonyms UA (–∫–æ–Ω–≤–µ—Ä—Ç–æ–≤–∞–Ω–æ + UA –ø–µ—Ä–µ–∫–ª–∞–¥–∏, –ø–µ—Ä—à—ñ 300)', merged.synonyms_ua.substring(0, 300) + '...');
            html += renderField('Translation EN', merged.translation_en);
            html += renderField('Translation UA', merged.translation_ua);
            html += '</div>';

            resultsEl.innerHTML = html;
        }

        function renderField(label, value) {
            return `
                <div class="field">
                    <div class="field-label">${label}</div>
                    <div class="field-value">${value || '(–ø—É—Å—Ç–æ)'}</div>
                </div>
            `;
        }

        window.clearResults = function() {
            document.getElementById('results').innerHTML = '';
            document.getElementById('status').innerHTML = '';
        };
    </script>
</body>
</html>
