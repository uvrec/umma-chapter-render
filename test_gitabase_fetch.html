<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>Test Gitabase Parser</title>
    <style>
        body { font-family: monospace; padding: 20px; }
        .log { margin: 10px 0; padding: 10px; background: #f0f0f0; }
        .error { background: #ffcccc; }
        .success { background: #ccffcc; }
        pre { white-space: pre-wrap; word-wrap: break-word; }
    </style>
</head>
<body>
    <h1>ğŸ§ª Gitabase Parser Test</h1>
    <button onclick="testGitabase()">Test Gitabase CC Antya 3.6.1</button>
    <div id="output"></div>

    <script>
        async function testGitabase() {
            const output = document.getElementById('output');
            output.innerHTML = '<div class="log">â³ Fetching Gitabase...</div>';

            try {
                // URL Ğ´Ğ»Ñ Antya-lila 3, chapter 6, verse 1
                const url = 'https://gitabase.com/uk/CC/3/6/1';

                output.innerHTML += `<div class="log">ğŸŒ URL: ${url}</div>`;

                const response = await fetch(url);
                const html = await response.text();

                output.innerHTML += `<div class="log success">âœ… Fetched ${html.length} characters</div>`;

                // Parse HTML
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');

                // Test selectors - EXACT selectors from user inspection
                const tests = [
                    { name: 'synonyms_uk', selector: 'div.dia_text' },
                    { name: 'translation_uk (EXACT)', selector: 'div.row:nth-child(5) > div:nth-child(1) > div:nth-child(2) > h4:nth-child(1) > b:nth-child(1)' },
                    { name: 'purport_uk container (EXACT)', selector: 'div.row:nth-child(6) > div:nth-child(1) > div:nth-child(2) > div:nth-child(1)' },
                    { name: 'purport_uk paragraphs', selector: 'div.row:nth-child(6) > div:nth-child(1) > div:nth-child(2) > div:nth-child(1) p' },
                ];

                tests.forEach(test => {
                    const elements = doc.querySelectorAll(test.selector);
                    const found = elements.length > 0;
                    const firstContent = found ? (elements[0].textContent?.substring(0, 100) || '') : 'N/A';

                    output.innerHTML += `<div class="log ${found ? 'success' : 'error'}">
                        ${found ? 'âœ…' : 'âŒ'} ${test.name}: ${elements.length} elements
                        ${found ? `<pre>${firstContent}...</pre>` : ''}
                    </div>`;
                });

                // Test synonyms_uk parsing with EXACT selector
                const diaTextEl = doc.querySelector('div.dia_text');
                if (diaTextEl) {
                    const synonyms_uk = diaTextEl.textContent?.trim() || '';
                    output.innerHTML += `<div class="log success">
                        ğŸ“ Parsed synonyms_uk from div.dia_text (${synonyms_uk.length} chars):
                        <pre>${synonyms_uk.substring(0, 300)}...</pre>
                    </div>`;
                } else {
                    output.innerHTML += `<div class="log error">âŒ div.dia_text not found for synonyms!</div>`;
                }

                // Test purport_uk parsing with EXACT selector
                const commentaryContainer = doc.querySelector('div.row:nth-child(6) > div:nth-child(1) > div:nth-child(2) > div:nth-child(1)');
                if (commentaryContainer) {
                    const paragraphs = Array.from(commentaryContainer.querySelectorAll('p'));
                    const parts = [];
                    paragraphs.forEach(p => {
                        const text = p.textContent?.trim() || '';
                        if (text.length > 50) {
                            parts.push(text);
                        }
                    });
                    const purport_uk = parts.join('\n\n');
                    output.innerHTML += `<div class="log success">
                        ğŸ“ Parsed purport_uk (${paragraphs.length} paragraphs, ${purport_uk.length} chars total):
                        <pre>${purport_uk.substring(0, 300)}...</pre>
                    </div>`;
                } else {
                    output.innerHTML += `<div class="log error">âŒ purport container not found!</div>`;
                }

            } catch (error) {
                output.innerHTML += `<div class="log error">âŒ Error: ${error.message}</div>`;
            }
        }
    </script>
</body>
</html>
