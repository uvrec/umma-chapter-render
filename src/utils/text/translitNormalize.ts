// src/utils/text/translitNormalize.ts

/**
 * Нормалізує український трансліт для коректного рендеру діакритики
 * - замінює "і̄" (кирилична і + макрон) на латинську ДОТЛЕС-секвенцію "ı̄":
 *   U+0131 (dotless i) + U+0304 (macron), що візуально відповідає "і" без крапки з макроном.
 * - залишає звичайну кирилицю недоторканою.
 *
 * Викликайте тільки для фрагментів, які ви позначаєте як транслітерацію.
 */
export function normalizeTransliteration(input: string): string {
  if (!input) return input;

  // Уніфікуємо комб. діакритику в NFC, але збережемо керований випадок.
  // Спочатку перетворимо найпроблемніші комбінації.
  // 1) кирилична "і" + макрон → DOTLESS латинська "ı" + макрон
  const CYR_I = "\u0456";       // і
  const MACRON = "\u0304";      // ̄

  let out = input.replace(new RegExp(`${CYR_I}${MACRON}`, "g"), "\u0131\u0304"); // ı̄

  // Можна додати ще спеціальні випадки (якщо у ваших правилах були):
  // напр. ї (дієр), ӯ тощо – залишаю як еталон:
  // out = out.replace(/\u0438\u0304/g, "\u0131\u0304"); // приклад (вимкнено)

  // Нормалізуємо до NFC, щоб шрифти рідше "ламались"
  try {
    out = out.normalize("NFC");
  } catch {
    // ignore if normalize is unsupported
  }
  return out;
}
