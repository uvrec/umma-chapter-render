@import "./styles/fonts.css";
@tailwind base;
@tailwind components;
@tailwind utilities;

/* ==========================================
   VEDAVOICE.ORG — Духовна практика в цифровому форматі
   Читай | Слухай | REPEAT
   ========================================== */

/* =========================
   STICKY HEADER - ГАРАНТОВАНИЙ
   ========================= */
.site-header {
  position: -webkit-sticky !important; /* Safari prefix ПЕРЕД стандартним */
  position: sticky !important;
  top: 0 !important;
  z-index: 50 !important;
}

/* =========================
   ДИЗАЙН-ГАЙДЛАЙН: БЕЗ КАРТОК І ВІЗУАЛЬНОГО ШУМУ
   =========================

   ВАЖЛИВО: Єдине місце де можуть бути картки — це бібліотека з обкладинками книжок!

   НЕ використовуємо:
   - Card компоненти (окрім обкладинок книг)
   - border (рамки)
   - shadow (тіні)
   - rounded з background (сірі блоки)
   - лінії-розділювачі (border-t, border-b, тощо)

   Використовуємо замість цього:
   - Чистий текст на прозорому фоні (bg-background)
   - Типографічну ієрархію (розміри шрифтів, жирність)
   - Простір (margin, padding) для візуального розділення

   Причина: краще читання без візуального шуму, як у книжці.
   ========================= */

/* =========================
   ШРИФТОВІ СТЕКИ ВБ
   ========================= */
:root {
  /* Основний текст (кирилиця + латиниця) - Noto Serif variable 100-900 */
  --font-primary: "Noto Serif", Georgia, serif;

  /* Транслітерація (verse text) */
  --font-translit: "Noto Serif", serif;

  /* Деванагарі (देवनागरी) - Noto Sans з Devanagari підтримкою */
  --font-devanagari: "Noto Sans Devanagari", sans-serif;

  /* Бенгалі (বাংলা) - Noto Serif для транслітерації */
  --font-bengali: "Noto Serif", serif;

  /* Послівний переклад (synonyms) - Noto Serif з підтримкою діакритики */
  --font-synonyms: "Noto Serif", serif;

  /* UI (інтерфейс) */
  --font-ui: sans-serif;
}

/* =========================
   РОЗМІРИ ЧИТАЛКИ

   АРХІТЕКТУРА ДИНАМІЧНИХ РОЗМІРІВ:

   1. CSS змінні (цей блок):
      - Базові розміри для responsive breakpoints
      - --vv-reader-font-size змінюється на різних екранах

   2. useReaderSettings hook (src/hooks/useReaderSettings.ts):
      - Керує fontSize (12-24px) та lineHeight (1.3-2.0)
      - Синхронізує з localStorage
      - Надає increaseFont/decreaseFont методи

   3. VedaReaderDB компонент:
      - Отримує fontSize з useReaderSettings
      - Передає props в VerseCard/DualLanguageVerseCard

   4. Inline styles в компонентах:
      - Sanskrit: fontSize * 1.5 (наприклад, 18px * 1.5 = 27px)
      - Transliteration: fontSize * 1.1 (наприклад, 18px * 1.1 = 19.8px)
      - Перевизначають CSS класи для динамічної зміни

   ========================= */
:root {
  /* ⚠️ ВАЖЛИВО: Ця змінна АВТОМАТИЧНО оновлюється через useReaderSettings
     НЕ змінюйте це значення напряму - воно керується JavaScript
     Значення адаптується до розміру екрану: 15px (XS) → 16px (Mobile) → 18px (Tablet) → 20px (Desktop) */
  --vv-reader-font-size: 18px; /* базове значення, перевизначається useReaderSettings */
  --vv-reader-line-height: 1.75; /* 1.75 для кращої читабельності */
  --vv-reader-max-width: 48rem;

  /* Деванагарі */
  --sanskrit-font-size: 1.125em; /* Mobile: em-text-lg */
  --sanskrit-line-height: 1.618; /* golden ratio */

  /* Трансліт - em-text-base (1em) */
  --translit-font-size: 1em; /* 1 * 18px = 18px (перевизначається inline styles) */
  --translit-line-height: 1.618;

  /* Послівний - text-base (1rem) */
  --synonyms-font-size: 1rem; /* 18px */
  --synonyms-line-height: 1.75;

  /* Пояснення - text-base (1rem) */
  --commentary-font-size: 1rem; /* 18px */
  --commentary-line-height: 1.75;

  /* Заголовки секцій - text-xl → lg:text-2xl */
  --section-header-font-size: 1.25rem; /* 20px на mobile */
  --section-header-font-size-lg: 1.5rem; /* 24px на desktop */

  /* Радіуси */
  --radius: 0.75rem;
}

/* =========================
   ТЕМИ: LIGHT (Теплий Крем)
   ========================= */
:root {
  /* Фон: теплий крем замість чистого білого */
  --background: 40 60% 96%;
  --foreground: 30 30% 20%;

  /* Картки: ще світліший крем */
  --card: 40 55% 98%;
  --card-foreground: 30 30% 20%;

  /* Popover */
  --popover: 40 55% 98%;
  --popover-foreground: 30 30% 20%;

  /* Primary: бурштин */
  --primary: 33 76% 42%;
  --primary-foreground: 48 100% 98%;
  --primary-hover: 33 76% 38%;

  /* Secondary */
  --secondary: 38 35% 92%;
  --secondary-foreground: 30 30% 25%;

  /* Muted */
  --muted: 38 30% 92%;
  --muted-foreground: 30 20% 45%;

  /* Accent: теплий золотистий */
  --accent: 38 70% 50%;
  --accent-foreground: 40 10% 98%;

  /* Destructive */
  --destructive: 0 72% 51%;
  --destructive-foreground: 48 100% 98%;

  /* Бордери: ледь помітні */
  --border: 38 25% 88%;
  --input: 38 25% 88%;
  --ring: 33 76% 42%;

  color-scheme: light;
}

/* =========================
   ТЕМИ: DARK (Теплий Темний)
   ========================= */
html.dark {
  /* Фон: теплий темний, не холодний сірий */
  --background: 30 15% 12%;
  --foreground: 40 40% 88%;

  /* Картки */
  --card: 30 18% 15%;
  --card-foreground: 40 40% 88%;

  /* Popover */
  --popover: 30 18% 15%;
  --popover-foreground: 40 40% 88%;

  /* Primary: золотистий */
  --primary: 38 80% 55%;
  --primary-foreground: 30 10% 10%;
  --primary-hover: 38 80% 50%;

  /* Secondary */
  --secondary: 28 20% 22%;
  --secondary-foreground: 40 35% 85%;

  /* Muted */
  --muted: 28 20% 22%;
  --muted-foreground: 38 25% 65%;

  /* Accent */
  --accent: 38 75% 50%;
  --accent-foreground: 30 10% 10%;

  /* Destructive */
  --destructive: 0 62% 45%;
  --destructive-foreground: 40 35% 95%;

  /* Бордери */
  --border: 28 18% 25%;
  --input: 28 18% 25%;
  --ring: 38 80% 55%;

  color-scheme: dark;
}

/* =========================
   ТЕМИ: CRAFT (Папір з фактурою)
   ========================= */
html.craft {
  --background: 39 58% 86%;
  --foreground: 26 36% 16%;

  --card: 39 58% 86%;
  --card-foreground: 26 36% 16%;

  --popover: 39 58% 86%;
  --popover-foreground: 26 36% 16%;

  --border: 35 28% 78%;
  --input: 35 28% 78%;

  --muted: 36 25% 84%;
  --muted-foreground: 26 22% 38%;

  --secondary: 36 30% 90%;
  --secondary-foreground: 26 34% 22%;

  --primary: 33 76% 42%;
  --primary-foreground: 48 100% 98%;
  --primary-hover: 33 76% 38%;

  --accent: 31 70% 40%;
  --accent-foreground: 48 100% 98%;

  --destructive: 8 74% 46%;
  --destructive-foreground: 48 100% 98%;

  --ring: 33 76% 42%;

  color-scheme: light;

  /* Фактурний фон */
  background-color: hsl(var(--background));
  background-image: radial-gradient(hsl(0 0% 0% / 0.035) 1px, transparent 1px);
  background-size: 16px 16px;
}

/* =========================
   ТЕМИ: SEPIA (Ностальгія)
   ========================= */
html.sepia {
  --background: 40 30% 85%;
  --foreground: 30 40% 25%;

  --card: 40 28% 88%;
  --card-foreground: 30 40% 25%;

  --popover: 40 28% 88%;
  --popover-foreground: 30 40% 25%;

  --muted: 38 25% 80%;
  --muted-foreground: 32 30% 40%;

  --secondary: 38 28% 82%;
  --secondary-foreground: 30 38% 28%;

  /* Accent: іржастий */
  --accent: 20 60% 45%;
  --accent-foreground: 40 25% 95%;

  --primary: 25 55% 40%;
  --primary-foreground: 40 25% 95%;
  --primary-hover: 25 55% 35%;

  --destructive: 0 65% 48%;
  --destructive-foreground: 40 25% 95%;

  --border: 38 20% 75%;
  --input: 38 20% 75%;
  --ring: 25 55% 40%;

  color-scheme: light;
}

/* =========================
   БАЗОВІ СТИЛІ
   ========================= */
html,
body {
  background-color: hsl(var(--background));
  color: hsl(var(--foreground));
  font-family: var(--font-primary);
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  /* Запобігання горизонтальному скролу на мобільних
     ВАЖЛИВО: overflow-x: clip замість hidden, бо hidden ламає position: sticky! */
  overflow-x: clip;
  max-width: 100vw;
}

/* Контейнер #root - також запобігаємо overflow
   ВАЖЛИВО: overflow-x: clip замість hidden, бо hidden ламає position: sticky! */
#root {
  overflow-x: clip;
  max-width: 100vw;
  /* iOS/Android Safe Area - для notch, home indicator, Dynamic Island */
  padding-top: env(safe-area-inset-top);
  padding-bottom: env(safe-area-inset-bottom);
  padding-left: env(safe-area-inset-left);
  padding-right: env(safe-area-inset-right);
  /* Мінімальна висота для повного екрану */
  min-height: 100vh;
  min-height: 100dvh; /* Dynamic viewport height для iOS Safari */
}

/* =========================
   TIPTAP РЕДАКТОР (ЗАХИСТ ВІД ЗОВНІШНІХ СТИЛІВ)
   ========================= */

/* ProseMirror контейнер - основний елемент TipTap редактора */
.ProseMirror {
  /* Скидаємо успадковані стилі від prose-reader */
  font-size: 1rem !important;
  line-height: 1.5 !important;

  /* Базові стилі редактора */
  outline: none;
  min-height: inherit;
  padding: inherit;
}

/* Параграфи в редакторі НЕ повинні успадковувати стилі prose-reader */
.ProseMirror p {
  font-size: 1rem !important;
  line-height: 1.5 !important;
  margin: 0.75em 0 !important;
}

/* Списки в редакторі */
.ProseMirror ul,
.ProseMirror ol {
  font-size: 1rem !important;
  line-height: 1.5 !important;
  margin: 0.75em 0 !important;
  padding-left: 1.5em !important;
}

.ProseMirror li {
  font-size: 1rem !important;
  line-height: 1.5 !important;
  margin: 0.25em 0 !important;
}

/* Заголовки в редакторі */
.ProseMirror h1 {
  font-size: 2em !important;
  line-height: 1.2 !important;
  margin: 0.75em 0 0.5em !important;
  font-weight: 700 !important;
}

.ProseMirror h2 {
  font-size: 1.5em !important;
  line-height: 1.3 !important;
  margin: 0.75em 0 0.5em !important;
  font-weight: 700 !important;
}

.ProseMirror h3 {
  font-size: 1.25em !important;
  line-height: 1.4 !important;
  margin: 0.75em 0 0.5em !important;
  font-weight: 600 !important;
}

/* Цитати в редакторі */
.ProseMirror blockquote {
  border-left: 3px solid hsl(var(--border));
  padding-left: 1em;
  margin: 1em 0;
  font-style: italic;
  color: hsl(var(--muted-foreground));
}

/* Код в редакторі */
.ProseMirror code {
  background: hsl(var(--muted));
  padding: 0.2em 0.4em;
  border-radius: 3px;
  font-family: monospace;
  font-size: 0.9em;
}

.ProseMirror pre {
  background: hsl(var(--muted));
  padding: 1em;
  border-radius: 6px;
  overflow-x: auto;
  margin: 1em 0;
}

.ProseMirror pre code {
  background: transparent;
  padding: 0;
}

/* Placeholder */
.ProseMirror p.is-editor-empty:first-child::before {
  color: hsl(var(--muted-foreground));
  content: attr(data-placeholder);
  float: left;
  height: 0;
  pointer-events: none;
}

/* Захист від prose-reader для вкладених елементів */
.prose-reader .ProseMirror p,
.prose-reader .ProseMirror li,
.prose-reader .ProseMirror h1,
.prose-reader .ProseMirror h2,
.prose-reader .ProseMirror h3 {
  font-size: inherit !important;
  line-height: inherit !important;
}

/* =========================
   АДАПТИВНІСТЬ
   ========================= */

/* Desktop (>1024px) */
@media (min-width: 1024px) {
  :root {
    --vv-reader-font-size: 20px; /* збільшено для десктопу */
    --sanskrit-font-size: 1.875em; /* Desktop: em-text-3xl (1.875 * 20px = 37.5px) */
    --translit-font-size: 1.25em; /* Desktop: em-text-xl (1.25 * 20px = 25px) */
    --synonyms-font-size: 1.125rem; /* lg:text-lg = 22.5px */
    --commentary-font-size: 1.125rem; /* lg:text-lg = 22.5px */
    --section-header-font-size-lg: 1.5rem; /* 30px для заголовків */
    --vv-reader-line-height: 1.75;
    --vv-reader-max-width: 48rem;
  }

  .verse-surface {
    padding: 3rem 2.5rem;
  }
}

/* Tablet (640-1023px) - sm to md breakpoint */
@media (min-width: 640px) and (max-width: 1023px) {
  :root {
    --vv-reader-font-size: 18px; /* базовий */
    --sanskrit-font-size: 1.5em; /* 27px */
    --translit-font-size: 1em; /* 18px */
    --synonyms-font-size: 1rem; /* 18px */
    --commentary-font-size: 1rem; /* 18px */
    --section-header-font-size: 1.25rem; /* 22.5px */
    --vv-reader-line-height: 1.75;
  }

  .verse-surface {
    padding: 2rem 1.5rem;
  }
}

/* Mobile (<640px) */
@media (max-width: 639px) {
  :root {
    --vv-reader-font-size: 16px; /* трохи менше для мобільних */
    --sanskrit-font-size: 1.375em; /* 22px - більше ніж було */
    --translit-font-size: 1em; /* 16px */
    --synonyms-font-size: 1rem; /* 16px */
    --commentary-font-size: 1rem; /* 16px */
    --section-header-font-size: 1.125rem; /* 18px */
    --vv-reader-line-height: 1.75;
  }

  .verse-surface {
    padding: 1.5rem 1rem;
  }

  .sanskrit-block {
    padding: 1.5rem 1rem;
  }

  .translit-block {
    padding: 1rem 1rem 1.5rem;
  }

  /* Touch targets - стандарт доступності Apple HIG (44x44px) */
  button,
  a,
  [role="button"],
  input[type="checkbox"],
  input[type="radio"] {
    min-height: 44px;
    min-width: 44px;
  }

  /* Винятки для inline посилань у тексті */
  p a,
  span a,
  .prose a {
    min-height: unset;
    min-width: unset;
  }

  /* Збільшуємо tap area для іконок у кнопках */
  button[class*="size-icon"] {
    min-height: 44px;
    min-width: 44px;
  }

  /* Секції між віршами */
  .verse-section {
    margin-bottom: 1.5rem;
  }
}

/* Дуже маленькі екрани (<420px) - xs breakpoint */
@media (max-width: 419px) {
  :root {
    --vv-reader-font-size: 15px;
    --sanskrit-font-size: 1.25em; /* 18.75px - більше */
    --translit-font-size: 0.9375em; /* 14px */
    --synonyms-font-size: 0.9375rem; /* 14px */
    --commentary-font-size: 0.9375rem; /* 14px */
    --section-header-font-size: 1.0625rem; /* 16px */
  }

  .verse-surface {
    padding: 1rem 0.75rem;
  }

  .sanskrit-block {
    padding: 1rem 0.75rem;
  }
}

/* =========================
   АУДІО КНОПКИ
   ========================= */

.audio-button {
  min-width: 48px;
  min-height: 48px;
  border-radius: 50%;
  transition: all 200ms cubic-bezier(0.4, 0, 0.2, 1);
  display: inline-flex;
  align-items: center;
  justify-content: center;
}

.audio-button:hover {
  background: hsl(var(--accent) / 0.1);
  transform: scale(1.05);
}

.audio-button:active {
  transform: scale(0.95);
}

.audio-button:disabled {
  opacity: 0.4;
  cursor: not-allowed;
}

/* =========================
   TEXTAREA ТРАНСЛІТЕРАТОРА
   ========================= */

/* Базові стилі для всіх textarea в транслітераторі */
/* ⚠️ ВАЖЛИВО: !important потрібен щоб перевизначити Tailwind text-sm з Textarea компонента */
textarea.iast-text,
textarea.devanagari-text,
textarea.bengali-text,
textarea.transliteration-output {
  font-size: 1.125rem !important; /* 18px - перевизначає Tailwind text-sm */
  line-height: 1.6 !important;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  text-rendering: optimizeLegibility;
}

/* IAST (латиниця з діакритикою) */
textarea.iast-text {
  font-family: "Noto Serif", serif !important;
  font-weight: 400;
}

/* Деванагарі */
textarea.devanagari-text {
  font-family: "Noto Sans Devanagari", sans-serif !important;
  font-weight: 400;
}

/* Бенгалі */
textarea.bengali-text {
  font-family: "Noto Serif", serif !important;
  font-weight: 400;
}

/* Вихідний текст (українська кирилиця з діакритикою) */
textarea.transliteration-output {
  font-family: "Noto Serif", serif !important;
  font-weight: 400;
}

/* =========================
   TRANSLITERATION LINES
   ========================= */

/* Кожен рядок транслітерації на окремому рядку */
.transliteration-lines .line {
  display: block;
  margin-bottom: 0.25em;
}

/* =========================
   UTILITY CLASSES
   ========================= */

.brand-gradient {
  background: linear-gradient(135deg, hsl(33, 76%, 42%) 0%, hsl(38, 80%, 55%) 100%);
}

.text-balance {
  text-wrap: balance;
}

.smooth-transition {
  transition: all 300ms cubic-bezier(0.4, 0, 0.2, 1);
}

/* =========================
   DROP CAP для коментарів
   ========================= */

.drop-cap {
  float: left;
  font-size: 3.5em;
  line-height: 0.8;
  padding-right: 8px;
  padding-top: 4px;
  color: hsl(var(--primary));
  font-weight: bold;
  font-family: serif;
}

/* Забезпечуємо успадкування font-size в HTML контенті */
div[style*="fontSize"] *,
p[style*="fontSize"] * {
  font-size: inherit;
  line-height: inherit;
}

/* Виключення для drop-cap - він має власний розмір */
div[style*="fontSize"] .drop-cap,
p[style*="fontSize"] .drop-cap {
  font-size: 3.5em;
  line-height: 0.8;
}

/* =========================
   PURPORT STYLING
   ========================= */

/* Заголовок "КОМЕНТАР" / "ПОЯСНЕННЯ" */
.purport-title {
  font-weight: bold;
  text-align: center;
  letter-spacing: 0.1em;
  margin: 1.5em 0 1em 0;
  font-size: inherit;
}

/* Параграфи пояснення */
.purport {
  text-align: justify;
  margin-bottom: 1em;
  text-indent: 25px;
  font-size: inherit;
  line-height: inherit;
}

.purport em {
  font-style: italic;
}

.purport strong {
  font-weight: bold;
}

/* Перший параграф - без відступу (бо є drop cap) */
.purport.first {
  text-indent: 0;
}

/* Цитати всередині пояснення - відцентровані */
.verse-quote,
blockquote.verse-quote {
  text-align: center;
  font-style: italic;
  margin: 1.5em 2em;
  padding: 1em;
  border-left: 3px solid hsl(var(--primary) / 0.5);
  background: hsl(var(--muted) / 0.3);
  border-radius: 0 0.5em 0.5em 0;
}

/* Завершальний параграф */
.purport-outro {
  text-align: center;
  font-style: italic;
  margin-top: 2em;
  color: hsl(var(--muted-foreground));
}

/* Нумеровані списки в поясненні */
.purport-list {
  list-style-type: decimal;
  list-style-position: outside;
  margin: 1em 0 1em 2em;
  padding-left: 0.5em;
}

.purport-list li {
  text-align: justify;
  margin-bottom: 0.75em;
  padding-left: 0.5em;
}

/* =========================
   СКИДАННЯ VITE СТИЛІВ
   ========================= */

:where(#root, .logo, .read-the-docs) {
  all: unset;
}

@keyframes logo-spin {
  from {
    transform: none;
  }
  to {
    transform: none;
  }
}

/* =========================
   MOBILE SAFE MODE
   Вимикає складні ефекти для старих телефонів
   ========================= */
[data-mobile-safe-mode="true"] {
  /* Вимикаємо backdrop-blur всюди */
  .backdrop-blur,
  .backdrop-blur-sm,
  .backdrop-blur-md,
  .backdrop-blur-lg,
  .backdrop-blur-xl,
  [class*="backdrop-blur"] {
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
  }

  /* Вимикаємо складні тіні */
  .shadow-glow,
  [class*="shadow-glow"] {
    box-shadow: none !important;
  }

  /* Спрощуємо градієнти на фоні */
  .bg-gradient-to-br,
  .bg-gradient-to-r,
  .bg-gradient-to-b,
  [class*="bg-gradient"] {
    background-image: none !important;
    background-color: hsl(var(--background)) !important;
  }

  /* Вимикаємо анімації розмиття */
  * {
    filter: none !important;
  }

  /* Замінюємо напівпрозорі фони на solid */
  .bg-background\/80,
  .bg-background\/90,
  .bg-card\/80,
  .bg-card\/90,
  [class*="\/80"],
  [class*="\/90"] {
    opacity: 1 !important;
  }

  /* Спрощуємо sticky headers */
  .sticky {
    background-color: hsl(var(--background)) !important;
  }
}

/* =========================
   SAFE AREA UTILITIES
   Для iOS notch, Dynamic Island, home indicator
   Для Android edge-to-edge mode
   ========================= */

/* Fixed bottom elements need safe-area padding */
.safe-bottom {
  padding-bottom: env(safe-area-inset-bottom);
}

.safe-top {
  padding-top: env(safe-area-inset-top);
}

.safe-left {
  padding-left: env(safe-area-inset-left);
}

.safe-right {
  padding-right: env(safe-area-inset-right);
}

/* For fixed elements - position offset instead of padding */
.fixed-safe-bottom {
  bottom: env(safe-area-inset-bottom);
}

.fixed-safe-top {
  top: env(safe-area-inset-top);
}

/* Capacitor/Cordova specific - iOS keyboard handling */
body.keyboard-open {
  --keyboard-height: var(--keyboard-height, 0px);
}

/* iOS specific: prevent rubber-banding on fixed elements */
@supports (-webkit-touch-callout: none) {
  .fixed, [class*="fixed"] {
    -webkit-transform: translateZ(0);
    transform: translateZ(0);
  }
}

/* Android navigation bar gesture hint area */
@supports (padding-bottom: env(safe-area-inset-bottom)) {
  .gesture-safe {
    padding-bottom: max(env(safe-area-inset-bottom), 8px);
  }
}
