# üéâ PARSER FIXES - –£–°–ü–Ü–®–ù–û –ü–†–û–¢–ï–°–¢–û–í–ê–ù–û

**–î–∞—Ç–∞:** 6 –ª–∏—Å—Ç–æ–ø–∞–¥–∞ 2025  
**–¢–µ—Å—Ç–∏:** SCC Antya 6.2, SCC Antya 6.17 ‚úÖ

---

## üêõ –í–ò–ü–†–ê–í–õ–ï–ù–Ü –ë–ê–ì–ò

### BUG #1: UnboundLocalError –≤ playwright_parser.py

**–õ–æ–∫–∞—Ü—ñ—è:** `tools/playwright_parser.py:529`  
**–ü—Ä–æ–±–ª–µ–º–∞:** –ó–º—ñ–Ω–Ω–∞ `transliteration_uk` –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞–ª–∞—Å—è –¥–æ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó  
**–í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è:** –î–æ–¥–∞–Ω–æ `transliteration_uk = ""` –Ω–∞ –ø–æ—á–∞—Ç–∫—É —Ñ—É–Ω–∫—Ü—ñ—ó `parse_gitabase_verse()`

```python
# ‚úÖ FIX: Initialize to avoid UnboundLocalError
transliteration_uk = ""
```

---

### BUG #2: –í—ñ–¥—Å—É—Ç–Ω—è MERGE –ª–æ–≥—ñ–∫–∞ –≤ –Ω–æ—Ä–º–∞–ª—ñ–∑–∞—Ç–æ—Ä—ñ

**–õ–æ–∫–∞—Ü—ñ—è:** `tools/pre_import_normalizer.py:691-723`  
**–ü—Ä–æ–±–ª–µ–º–∞:**
- Parser (`playwright_parser.py`) –ø–æ–≤–µ—Ä—Ç–∞—î –¢–Ü–õ–¨–ö–ò —É–∫—Ä–∞—ó–Ω—Å—å–∫—ñ **–∑–Ω–∞—á–µ–Ω–Ω—è** –∑ Gitabase (–±–µ–∑ —Ç–µ—Ä–º—ñ–Ω—ñ–≤)
- –§–æ—Ä–º–∞—Ç: `"—è —Å–∫–ª–∞–¥–∞—é –ø–æ–∫–ª–æ–Ω–∏ ; –¥—É—Ö–æ–≤–Ω–∏–º –≤—á–∏—Ç–µ–ª—è–º ; ..."`
- –ù–æ—Ä–º–∞–ª—ñ–∑–∞—Ç–æ—Ä –ù–ï –¥–æ–¥–∞–≤–∞–≤ —É–∫—Ä–∞—ó–Ω—Å—å–∫—ñ **—Ç–µ—Ä–º—ñ–Ω–∏** –Ω–∞–∑–∞–¥
- –†–µ–∑—É–ª—å—Ç–∞—Ç: synonyms_uk –±—É–≤ –ù–ï–ü–û–í–ù–ò–ú

**–í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è:** –î–æ–¥–∞–Ω–æ MERGE –ª–æ–≥—ñ–∫—É:

1. **–í–∏—Ç—è–≥—Ç–∏ IAST —Ç–µ—Ä–º—ñ–Ω–∏** –∑ `synonyms_en` (Vedabase)
   - –§–æ—Ä–º–∞—Ç: `"vande ‚Äî I offer; gurun ‚Äî spiritual masters"`
   - –†–µ–∑—É–ª—å—Ç–∞—Ç: `["vande", "gurun", ...]`

2. **–ö–æ–Ω–≤–µ—Ä—Ç—É–≤–∞—Ç–∏ IAST ‚Üí —É–∫—Ä–∞—ó–Ω—Å—å–∫–∞ —Ç—Ä–∞–Ω—Å–ª—ñ—Ç–µ—Ä–∞—Ü—ñ—è**
   - `vande` ‚Üí `–≤–∞–Ω–¥–µ`
   - `gurun` ‚Üí `“ë—É—Ä—É–Ω`
   - –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è: `convert_english_to_ukrainian_translit()` + `normalize_diacritics()`

3. **–û–±'—î–¥–Ω–∞—Ç–∏ –∑ —É–∫—Ä–∞—ó–Ω—Å—å–∫–∏–º–∏ –∑–Ω–∞—á–µ–Ω–Ω—è–º–∏** –∑ `synonyms_uk` (Gitabase)
   - –£–∫—Ä–∞—ó–Ω—Å—å–∫—ñ –∑–Ω–∞—á–µ–Ω–Ω—è: `["—è —Å–∫–ª–∞–¥–∞—é –ø–æ–∫–ª–æ–Ω–∏", "–¥—É—Ö–æ–≤–Ω–∏–º –≤—á–∏—Ç–µ–ª—è–º", ...]`
   - –†–µ–∑—É–ª—å—Ç–∞—Ç: `"–≤–∞–Ω–¥–µ ‚Äî —è —Å–∫–ª–∞–¥–∞—é –ø–æ–∫–ª–æ–Ω–∏; “ë—É—Ä—É–Ω ‚Äî –¥—É—Ö–æ–≤–Ω–∏–º –≤—á–∏—Ç–µ–ª—è–º"`

```python
# ‚úÖ MERGE: Parser –ø–æ–≤–µ—Ä—Ç–∞—î –¢–Ü–õ–¨–ö–ò —É–∫—Ä–∞—ó–Ω—Å—å–∫—ñ –∑–Ω–∞—á–µ–Ω–Ω—è (–±–µ–∑ —Ç–µ—Ä–º—ñ–Ω—ñ–≤)
if verse.get('synonyms_uk') and verse.get('synonyms_en'):
    # –í–∏—Ç—è–≥—É—î–º–æ IAST —Ç–µ—Ä–º—ñ–Ω–∏ –∑ synonyms_en
    en_pairs = [p.strip() for p in verse['synonyms_en'].split(';') if p.strip()]
    ua_values = [v.strip() for v in verse['synonyms_uk'].split(';') if v.strip()]
    
    merged_pairs = []
    for i, en_pair in enumerate(en_pairs):
        if '‚Äî' in en_pair:
            iast_term = en_pair.split('‚Äî', 1)[0].strip()
            # –ö–æ–Ω–≤–µ—Ä—Ç—É—î–º–æ IAST ‚Üí —É–∫—Ä–∞—ó–Ω—Å—å–∫–∞
            ua_term = convert_english_to_ukrainian_translit(iast_term)
            ua_term = normalize_diacritics(ua_term)
            
            # –ë–µ—Ä–µ–º–æ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–µ —É–∫—Ä–∞—ó–Ω—Å—å–∫–µ –∑–Ω–∞—á–µ–Ω–Ω—è
            ua_value = ua_values[i] if i < len(ua_values) else ''
            
            if ua_value:
                merged_pairs.append(f'{ua_term} ‚Äî {ua_value}')
    
    normalized['synonyms_uk'] = normalize_verse_field('; '.join(merged_pairs), 'synonyms')
```

---

## üìä –†–ï–ó–£–õ–¨–¢–ê–¢–ò –¢–ï–°–¢–Ü–í

### –¢–µ—Å—Ç #1: SCC Antya 6.2
```
Sanskrit: ‡¶ú‡¶Ø‡¶º ‡¶ú‡¶Ø‡¶º ‡¶∂‡ßç‡¶∞‡ßÄ‡¶ö‡ßà‡¶§‡¶®‡ßç‡¶Ø ‡¶ú‡¶Ø‡¶º ‡¶®‡¶ø‡¶§‡ßç‡¶Ø‡¶æ‡¶®‡¶®‡ßç‡¶¶ ‡•§
          ‡¶ú‡¶Ø‡¶º‡¶æ‡¶¶‡ßç‡¶¨‡ßà‡¶§‡¶ö‡¶®‡ßç‡¶¶‡ßç‡¶∞ ‡¶ú‡¶Ø‡¶º ‡¶ó‡ßå‡¶∞‡¶≠‡¶ï‡ßç‡¶§‡¶¨‡ßÉ‡¶®‡ßç‡¶¶ ‡•• ‡ß® ‡••

Synonyms UA:
  –¥–∂–∞—è –¥–∂–∞—è ‚Äî —Ö–≤–∞–ª–∞, —Ö–≤–∞–ª–∞
  —à—Äƒ´-—á–∞—ñ—Ç–∞–Ω–π–∞ ‚Äî –ì–æ—Å–ø–æ–¥—É –ß–∞–π—Ç–∞–Ω—å—ó
  –¥–∂–∞—è ‚Äî —Ö–≤–∞–ª–∞, —Ö–≤–∞–ª–∞
  –Ω—ñ—Ç–π–∞ÃÑ–Ω–∞–Ω–¥–∞ ‚Äî –ì–æ—Å–ø–æ–¥—É –ù—ñ—Ç—å—è–Ω–∞–Ω–¥—ñ
  ...

‚úÖ –ë–ï–ó –∞–Ω–≥–ª—ñ–π—Å—å–∫–æ–≥–æ fallback
‚úÖ –§–æ—Ä–º–∞—Ç "—Ç–µ—Ä–º—ñ–Ω ‚Äî –∑–Ω–∞—á–µ–Ω–Ω—è" –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π
```

### –¢–µ—Å—Ç #2: SCC Antya 6.17
```
Sanskrit: ‡¶π‡ßá‡¶®-‡¶ï‡¶æ‡¶≤‡ßá ‡¶Æ‡ßÅ‡¶≤‡ßÅ‡¶ï‡ßá‡¶∞ ‡¶è‡¶ï ‡¶Æ‡ßç‡¶≤‡ßá‡¶ö‡ßç‡¶õ ‡¶Ö‡¶ß‡¶ø‡¶ï‡¶æ‡¶∞‡ßÄ ‡•§
          ‡¶∏‡¶™‡ßç‡¶§‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ-‡¶Æ‡ßÅ‡¶≤‡ßÅ‡¶ï‡ßá‡¶∞ ‡¶∏‡ßá ‡¶π‡¶Ø‡¶º '‡¶ö‡ßå‡¶ß‡ßÅ‡¶∞‡ßÄ' ‡•• ‡ßß‡ß≠ ‡••

Synonyms UA (–ü–Ü–°–õ–Ø –í–ò–ü–†–ê–í–õ–ï–ù–ù–Ø):
  1. —Ö–µ–Ω–∞-–∫–∞ÃÑ–ª–µ ‚Äî –≤ —Ç–æ–π —á–∞—Å          ‚úÖ —É–∫—Ä–∞—ó–Ω—Å—å–∫–∏–π —Ç–µ—Ä–º—ñ–Ω + —É–∫—Ä–∞—ó–Ω—Å—å–∫–µ –∑–Ω–∞—á–µ–Ω–Ω—è
  2. –º—É–ª—É–∫–µ—Ä–∞ ‚Äî –∫—Ä–∞—ó–Ω–∏               ‚úÖ
  3. –µ–∫–∞ ‚Äî –æ–¥–∏–Ω                      ‚úÖ
  4. –º–ª–µ—á—á—Ö–∞ ‚Äî –º—É—Å—É–ª—å–º–∞–Ω–∏–Ω           ‚úÖ
  5. –∞–¥–≥—ñ–∫–∞ÃÑ—Äƒ´ ‚Äî —É—Ä—è–¥–æ–≤–µ—Ü—å            ‚úÖ
  6. —Å–∞–ø—Ç–∞“ë—Ä–∞ÃÑ–º–∞-–º—É–ª—É–∫–µ—Ä–∞ ‚Äî –°–∞–ø—Ç–∞“ë—Ä–∞–º–∏  ‚úÖ
  7. —Å–µ ‚Äî –≤—ñ–Ω                        ‚úÖ
  8. —Ö–∞–π–∞ ‚Äî –±—É–≤                      ‚úÖ
  9. —á–∞—É–¥–≥—É—Äƒ´ ‚Äî —á–∞—É–¥—Ö—É—Ä—ñ             ‚úÖ

‚úÖ 9 –ø–∞—Ä (100% –ø–æ–∫—Ä–∏—Ç—Ç—è)
‚úÖ –ë–ï–ó –∞–Ω–≥–ª—ñ–π—Å—å–∫–∏—Ö —Å–ª—ñ–≤
‚úÖ –§–æ—Ä–º–∞—Ç –ø–æ–≤–Ω—ñ—Å—Ç—é –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π
```

---

## üöÄ –ì–û–¢–û–í–û –î–û –í–ò–ö–û–†–ò–°–¢–ê–ù–ù–Ø

### –®–≤–∏–¥–∫–∏–π —Å—Ç–∞—Ä—Ç:

1. **–ó–∞–ø—É—Å—Ç–∏—Ç–∏ parse_server:**
   ```bash
   python3 tools/parse_server.py &
   ```

2. **–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ health:**
   ```bash
   curl http://127.0.0.1:5003/health
   # –û—á—ñ–∫—É—î—Ç—å—Å—è: {"status":"ok"}
   ```

3. **CLI —Ç–µ—Å—Ç:**
   ```bash
   python3 tools/playwright_parser.py \
     --verse-count 1 \
     --vedabase-base 'https://vedabase.io/en/library/cc/antya/6/17/' \
     --gitabase-base 'https://gitabase.com/ukr/CC/3/6'
   ```

4. **UI —ñ–º–ø–æ—Ä—Ç:**
   ```bash
   npm run dev
   # –í—ñ–¥–∫—Ä–∏—Ç–∏: http://localhost:5173/admin/import-wizard
   ```

---

## üìù –ó–ú–Ü–ù–ï–ù–Ü –§–ê–ô–õ–ò

- `tools/playwright_parser.py` (line 529)
- `tools/pre_import_normalizer.py` (lines 691-723)

---

## ‚úÖ –°–¢–ê–¢–£–°

**–ü–†–û–¢–ï–°–¢–û–í–ê–ù–û –¢–ê –ì–û–¢–û–í–û** - –≤—Å—ñ —Ç–µ—Å—Ç–∏ –ø—Ä–æ–π–¥–µ–Ω–æ —É—Å–ø—ñ—à–Ω–æ!
