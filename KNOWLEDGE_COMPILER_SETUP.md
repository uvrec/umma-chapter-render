# Knowledge Compiler - Інструкції по налаштуванню

## Статус функціональності

✅ **Frontend готовий** - Інтерфейс повністю функціональний
⚠️ **База даних** - Потребує застосування міграції для повного функціоналу

## Поточна робота

Інструмент працює в **режимі fallback** з простим пошуком через ILIKE запити.
Для отримання повної функціональності (векторний пошук, ранжування за релевантністю, статистика) потрібно застосувати міграцію бази даних.

## Як застосувати міграцію

### Варіант 1: Через Supabase Dashboard (рекомендовано)

1. Відкрийте ваш проект в [Supabase Dashboard](https://app.supabase.com)
2. Перейдіть в розділ **SQL Editor**
3. Створіть новий запит
4. Скопіюйте та виконайте вміст файлу:
   ```
   supabase/migrations/20251115200000_create_knowledge_compiler_functions.sql
   ```
5. Натисніть **Run** або `Ctrl/Cmd + Enter`

### Варіант 2: Через Supabase CLI (якщо встановлено)

```bash
# З кореневої директорії проекту
supabase db push

# Або для конкретної міграції
supabase migration up
```

## Що робить міграція

1. **Створює функцію `search_verses_fulltext()`**
   - Повнотекстовий пошук з PostgreSQL tsvector
   - Ранжування за релевантністю
   - Підсвічування знайдених фрагментів
   - Фільтрація по книгах

2. **Створює функцію `find_related_verses()`**
   - Пошук семантично схожих віршів
   - Корисно для побудови тематичних збірок

3. **Створює функцію `get_topic_statistics()`**
   - Статистика розподілу віршів по книгах
   - Приклади віршів для кожної книги

4. **Додає тригери для search_vector**
   - Автоматичне оновлення пошукового індексу
   - Вагове ранжування полів (Translation > Commentary > Synonyms)

5. **Створює GIN індекс**
   - Швидкий повнотекстовий пошук
   - Оптимізація для великих обсягів даних

## Перевірка статусу

Після застосування міграції інструмент автоматично використає нові функції.

**Як перевірити:**
1. Відкрийте `/tools/compiler`
2. Виконайте пошук
3. Якщо бачите повідомлення "Використовується простий пошук..." - міграція ще не застосована
4. Якщо пошук працює без цього повідомлення - все гаразд! ✅

## Troubleshooting

### Помилка: "function does not exist"
- **Причина:** Міграція не застосована
- **Рішення:** Виконайте міграцію через Dashboard або CLI

### Помилка при виконанні міграції
- **Причина:** Можлива помилка в SQL синтаксисі або конфлікт з існуючими об'єктами
- **Рішення:**
  1. Перевірте чи вже існують функції з такими іменами
  2. Видаліть старі версії якщо потрібно: `DROP FUNCTION IF EXISTS search_verses_fulltext;`

### Повільний пошук
- **Причина:** GIN індекс не створено або не побудовано
- **Рішення:**
  ```sql
  -- Перевірити індекс
  SELECT indexname FROM pg_indexes WHERE tablename = 'verses';

  -- Пересоздать якщо потрібно
  CREATE INDEX IF NOT EXISTS idx_verses_search_vector ON verses USING gin(search_vector);
  ```

## Функції які працюють без міграції

✅ Інтерфейс інструменту
✅ Простий пошук по тексту (ILIKE)
✅ Додавання віршів до збірки
✅ Експорт збірки в текстовий файл
✅ Навігація та фільтри

## Функції які потребують міграції

⚠️ Векторний пошук з ранжуванням
⚠️ Підсвічування знайдених фрагментів
⚠️ Пошук схожих віршів
⚠️ Статистика по темах
⚠️ Швидкий пошук для великих обсягів даних

## Підтримка

Якщо виникли проблеми:
1. Перевірте логи в консолі браузера (F12)
2. Перевірте логи Supabase в Dashboard
3. Переконайтесь що у вас є права адміністратора для виконання міграцій
